<!DOCTYPE html>
<html>
<head>
  <title>Tail Me Extension Files</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; background: #f5f5f5; }
    .file { margin: 20px 0; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    button { padding: 12px 24px; background: #FF6B6B; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: 600; }
    button:hover { background: #ff5252; }
    h1 { color: #333; text-align: center; }
    h2 { color: #555; margin: 0 0 10px 0; }
    .instructions { background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
    .instructions ol { margin: 10px 0; padding-left: 20px; }
    .instructions li { margin: 8px 0; }
  </style>
</head>
<body>
  <h1>ü¶ä Tail Me Extension Files</h1>
  
  <div class="instructions">
    <h3>üìã Instructions:</h3>
    <ol>
      <li>Create a folder on your Desktop called: <strong>tail-me-extension</strong></li>
      <li>Click each "Download" button below (all 6 files)</li>
      <li>Save all files to that folder</li>
      <li>Open Chrome ‚Üí <code>chrome://extensions</code></li>
      <li>Turn ON "Developer mode" (top right)</li>
      <li>Click "Load unpacked" ‚Üí Select the tail-me-extension folder</li>
    </ol>
  </div>

  <div class="file">
    <h2>1Ô∏è‚É£ manifest.json</h2>
    <button onclick="downloadFile('manifest.json', manifest)">Download manifest.json</button>
  </div>

  <div class="file">
    <h2>2Ô∏è‚É£ content.js</h2>
    <button onclick="downloadFile('content.js', contentJS)">Download content.js</button>
  </div>

  <div class="file">
    <h2>3Ô∏è‚É£ popup.html</h2>
    <button onclick="downloadFile('popup.html', popupHTML)">Download popup.html</button>
  </div>

  <div class="file">
    <h2>4Ô∏è‚É£ popup.js</h2>
    <button onclick="downloadFile('popup.js', popupJS)">Download popup.js</button>
  </div>

  <div class="file">
    <h2>5Ô∏è‚É£ background.js</h2>
    <button onclick="downloadFile('background.js', backgroundJS)">Download background.js</button>
  </div>

  <div class="file">
    <h2>6Ô∏è‚É£ socket.io.min.js</h2>
    <button onclick="window.open('https://cdn.socket.io/4.7.5/socket.io.min.js', '_blank')">Download socket.io.min.js</button>
    <p style="color: #666; font-size: 14px; margin-top: 10px;">‚ö†Ô∏è When it opens, press <strong>Ctrl+S</strong> to save as <strong>socket.io.min.js</strong></p>
  </div>

  <script>
    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    const manifest = `{
  "manifest_version": 3,
  "name": "Tail Me",
  "version": "1.0.2",
  "description": "Share what you're viewing in real-time",
  "permissions": ["storage", "activeTab", "tabs"],
  "host_permissions": ["<all_urls>"],
  "web_accessible_resources": [
    {
      "resources": ["socket.io.min.js"],
      "matches": ["<all_urls>"]
    }
  ],
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["content.js"],
      "run_at": "document_end"
    }
  ],
  "action": {
    "default_popup": "popup.html"
  }
}`;

    const contentJS = `console.log('ü¶ä Tail Me loaded on:', window.location.href);

let currentUser = null;
let floatingTail = null;
let socket = null;

const script = document.createElement('script');
script.src = chrome.runtime.getURL('socket.io.min.js');
script.onload = () => {
  console.log('‚úÖ Socket.io loaded');
  init();
};
(document.head || document.documentElement).appendChild(script);

function init() {
  chrome.storage.local.get(['tailMeUser'], (result) => {
    if (result.tailMeUser) {
      currentUser = result.tailMeUser;
      connectSocket();
      createFloatingTail();
      console.log('‚úÖ User found:', currentUser.username);
    }
  });
  chrome.runtime.onMessage.addListener((message) => {
    if (message.type === 'USER_LOGGED_IN') {
      currentUser = message.user;
      connectSocket();
      createFloatingTail();
    }
  });
}

function connectSocket() {
  if (socket) return;
  socket = io('https://maida-unvictualled-raina.ngrok-free.dev');
  socket.on('connect', () => {
    console.log('‚úÖ Connected to server!');
    socket.emit('register', currentUser);
  });
  socket.on('registration-complete', () => {
    console.log('‚úÖ Registered as:', currentUser.username);
  });
  socket.on('tail-received', (tail) => {
    console.log('üì¨ Tail received:', tail);
    showNotification(tail);
  });
}

function createFloatingTail() {
  if (floatingTail) return;
  floatingTail = document.createElement('div');
  floatingTail.innerHTML = 'ü¶ä';
  floatingTail.style.cssText = 'position:fixed!important;bottom:30px!important;right:30px!important;width:60px!important;height:60px!important;background:linear-gradient(135deg,#FF6B6B 0%,#FFD93D 100%)!important;border-radius:50%!important;display:flex!important;align-items:center!important;justify-content:center!important;font-size:30px!important;cursor:pointer!important;z-index:2147483647!important;box-shadow:0 5px 20px rgba(255,107,107,0.4)!important;animation:tailPulse 2s infinite!important;';
  const style = document.createElement('style');
  style.textContent = '@keyframes tailPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}';
  document.head.appendChild(style);
  floatingTail.onclick = showSendPopup;
  document.body.appendChild(floatingTail);
  console.log('‚úÖ Floating tail created!');
}

function showSendPopup() {
  const pageData = extractPageMetadata();
  const popup = document.createElement('div');
  popup.id = 'tail-popup';
  popup.innerHTML = '<div style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:2147483646;display:flex;align-items:center;justify-content:center;" onclick="document.getElementById(\\'tail-popup\\').remove()"><div style="background:white;border-radius:20px;padding:25px;width:400px;max-width:90vw;" onclick="event.stopPropagation()"><h2 style="margin:0 0 15px 0;">ü¶ä Share This Page</h2><p style="margin:0 0 15px 0;color:#666;font-size:14px;">'+pageData.title+'</p><input type="text" id="tail-recipient" placeholder="Send to..." style="width:100%;padding:12px;border:2px solid #E0E0E0;border-radius:10px;margin-bottom:12px;font-size:16px;box-sizing:border-box;"><textarea id="tail-message" placeholder="Your message..." style="width:100%;padding:12px;border:2px solid #E0E0E0;border-radius:10px;margin-bottom:12px;font-size:16px;min-height:60px;box-sizing:border-box;"></textarea><button id="tail-send-btn" style="width:100%;padding:12px;background:linear-gradient(135deg,#FF6B6B 0%,#FFD93D 100%);color:white;border:none;border-radius:10px;font-weight:600;font-size:16px;cursor:pointer;margin-bottom:8px;">Send Tail ü¶ä</button><button id="tail-cancel-btn" style="width:100%;padding:12px;background:#E0E0E0;color:#333;border:none;border-radius:10px;font-weight:600;font-size:16px;cursor:pointer;">Cancel</button></div></div>';
  document.body.appendChild(popup);
  document.getElementById('tail-send-btn').onclick = () => {
    const recipient = document.getElementById('tail-recipient').value.trim();
    const message = document.getElementById('tail-message').value.trim();
    if (!recipient) { alert('Enter a recipient'); return; }
    socket.emit('send-tail', { recipients: [recipient], url: window.location.href, title: pageData.title, message: message || 'Check this out!', image: pageData.image, price: pageData.price });
    popup.remove();
    showToast('Tail sent! ü¶ä');
  };
  document.getElementById('tail-cancel-btn').onclick = () => popup.remove();
}

function extractPageMetadata() {
  const title = document.querySelector('meta[property="og:title"]')?.content || document.title || 'Check this out!';
  const image = document.querySelector('meta[property="og:image"]')?.content || document.querySelector('img')?.src || '';
  let price = null;
  const priceSelectors = ['[itemprop="price"]', '.price', '[class*="price"]', '.a-price-whole'];
  for (const sel of priceSelectors) {
    const el = document.querySelector(sel);
    if (el) { price = el.textContent.trim(); break; }
  }
  return { title, image, price };
}

function showNotification(tail) {
  const notif = document.createElement('div');
  notif.style.cssText = 'position:fixed;top:20px;right:20px;width:350px;background:white;border-radius:15px;box-shadow:0 10px 40px rgba(0,0,0,0.2);z-index:2147483647;padding:20px;';
  notif.innerHTML = '<h3 style="margin:0 0 10px 0;color:#667EEA;">ü¶ä '+tail.from+' sent you a tail!</h3><p style="margin:0 0 15px 0;color:#333;">'+tail.message+'</p><button onclick="window.location.href=\\''+tail.url+'\\'" style="width:100%;padding:12px;background:#28C840;color:white;border:none;border-radius:10px;font-weight:600;cursor:pointer;margin-bottom:8px;">Catch üé£</button><button onclick="this.parentElement.remove()" style="width:100%;padding:12px;background:#E0E0E0;color:#333;border:none;border-radius:10px;font-weight:600;cursor:pointer;">Later</button>';
  document.body.appendChild(notif);
  setTimeout(() => notif.remove(), 30000);
}

function showToast(msg) {
  const toast = document.createElement('div');
  toast.style.cssText = 'position:fixed;bottom:100px;right:30px;background:#28C840;color:white;padding:15px 25px;border-radius:10px;z-index:2147483647;font-weight:600;';
  toast.textContent = msg;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}`;

    const popupHTML = `<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body { width: 300px; padding: 20px; font-family: sans-serif; margin: 0; }
    h2 { text-align: center; margin: 0 0 20px 0; }
    .logo { text-align: center; font-size: 50px; margin-bottom: 10px; }
    input, button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 2px solid #E0E0E0; font-size: 14px; box-sizing: border-box; }
    button { background: linear-gradient(135deg, #FF6B6B 0%, #FFD93D 100%); color: white; border: none; font-weight: 600; cursor: pointer; }
    .status { text-align: center; padding: 10px; background: #E8F4FF; border-radius: 8px; color: #667EEA; margin-bottom: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div id="login-view">
    <div class="logo">ü¶ä</div>
    <h2>Tail Me</h2>
    <input type="text" id="username" placeholder="Enter username" />
    <button id="login-btn">Get Started</button>
  </div>
  <div id="dashboard" class="hidden">
    <div class="logo">ü¶ä</div>
    <div class="status">Logged in as <strong id="user"></strong></div>
    <p style="text-align: center; color: #666; font-size: 12px;">The floating tail is now on every website!</p>
    <button id="logout-btn" style="background: #E0E0E0; color: #333;">Logout</button>
  </div>
  <script src="popup.js"></script>
</body>
</html>`;

    const popupJS = `document.addEventListener('DOMContentLoaded', () => {
  checkUser();
  document.getElementById('login-btn').addEventListener('click', login);
  document.getElementById('logout-btn').addEventListener('click', logout);
});

function checkUser() {
  chrome.storage.local.get(['tailMeUser'], (result) => {
    if (result.tailMeUser) showDashboard(result.tailMeUser);
  });
}

function showDashboard(user) {
  document.getElementById('login-view').classList.add('hidden');
  document.getElementById('dashboard').classList.remove('hidden');
  document.getElementById('user').textContent = user.username;
}

function login() {
  const username = document.getElementById('username').value.trim();
  if (!username) return alert('Enter username');
  const userData = { username: username };
  chrome.storage.local.set({ tailMeUser: userData }, () => {
    chrome.tabs.query({}, (tabs) => {
      tabs.forEach(tab => {
        chrome.tabs.sendMessage(tab.id, { type: 'USER_LOGGED_IN', user: userData }).catch(() => {});
      });
    });
    showDashboard(userData);
  });
}

function logout() {
  chrome.storage.local.remove('tailMeUser', () => location.reload());
}`;

    const backgroundJS = `chrome.runtime.onInstalled.addListener(() => {
  console.log('ü¶ä Tail Me installed!');
});`;
  </script>
</body>
</html>
